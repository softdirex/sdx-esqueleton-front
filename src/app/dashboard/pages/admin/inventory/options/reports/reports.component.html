<div class="col-12">
    <div class="row">
        <div class="col-12 mt-2 text-right">
            <button class="btn btn-warning btn-extra-small" (click)="close()" placement="bottom"
                ngbTooltip="Cerrar menú">Cerrar</button>
        </div>
        <div class="col-12 mb-2">
            <h5 class="text-center">Reporte</h5>
            <hr>
            <div class="row justify-content-center">
                <div class="col-2 text-{{isMobile?'center':'right'}}">
                    <button class="btn btn-danger btn-extra-small"
                        [disabled]="selectedStoreId == 0 || loading || loadingFile || isViewer"
                        (click)="exportPDF()">Exportar
                        PDF</button>
                </div>
                <div class="col-2 text-{{isMobile?'center':'right'}}">
                    <button class="btn btn-success btn-extra-small"
                        [disabled]="selectedStoreId == 0 || loading || loadingFile || isViewer"
                        (click)="exportExcel()">Exportar
                        Excel</button>
                </div>
                <div class="col-4 text-center">
                    <button class="btn btn-info btn-extra-small" (click)="loadHistoric()">Histórico</button>
                </div>
                <div class="col-4 text-{{isMobile?'center':'left'}}">
                    <button (click)="openModalSelect()" class="btn btn-primary btn-extra-small">Seleccionar
                        Bodega</button>
                </div>
            </div>
        </div>

    </div>
    <hr>
    <div *ngIf="loading" class="modal-body">
        <h5 class="text-center">Espere un momento...</h5>
        <img class="img-loading" src="./assets/img/gif/loading.gif">
    </div>
    <div *ngIf="errorMessage" class="row justify-content-center mt-2">
        <div class="col-12">
            <h6 class="alert-warning text-center">{{errorMessage}}</h6>
        </div>
    </div>
    <div *ngIf="selectedStoreId === 0 && reports && reports.length > 0" class="col-12">
        <h5 class="text-center">Reportes</h5>
    </div>

    <div *ngIf="selectedStoreId === 0 && reports && reports.length > 0" class="col-12">

        <hr *ngIf="!isMobile" class="card-header">

        <table class="table shop_table shop_table_responsive cart">
            <thead>
                <tr>
                    <th>Bodega</th>
                    <th>Fecha</th>
                    <th>Expirados</th>
                    <th>Stock bajo</th>
                    <th>Sin stock</th>
                    <th>Exceso de stock</th>
                    <th>Stock óptimo</th>
                    <th>Monto total</th>
                    <th></th>
                </tr>
            </thead>
            <tbody *ngIf="!loading">
                <tr *ngFor="let item of reports">
                    <hr *ngIf="isMobile" class="card-header border-0" />
                    <td data-title="Bodega">{{item.report.store_name|titlecase}}</td>
                    <td data-title="Fecha">{{item.date|date:'dd-MM-yyyy'}}</td>
                    <td data-title="Expirados">{{item.report.expired.amount|currency:'CLP'}}</td>
                    <td data-title="Stock bajo">{{item.report.low_stock.amount|currency:'CLP'}}</td>
                    <td data-title="Sin stock">{{item.report.empty_stock.amount|currency:'CLP'}}</td>
                    <td data-title="Exceso de stock">{{item.report.stock_max.amount|currency:'CLP'}}</td>
                    <td data-title="Stock óptimo">{{item.report.optimal_stock.amount|currency:'CLP'}}</td>
                    <td data-title="Monto total">{{item.report.total_amount|currency:'CLP'}}</td>
                    <td data-title="Acción">
                        <button class="btn btn-info btn-extra-small" (click)="openReport(item.report,item.date)"
                            [disabled]="!item.report.store_id">Seleccionar</button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <div class="col-12 mt-2" *ngIf="selectedStoreId === 0 && reports && reports.length > 0">
        <ngb-pagination [collectionSize]="totalItems" [pageSize]="limit" [(page)]="page" [maxSize]="5"
            [boundaryLinks]="true" (pageChange)="loadHistoric()" aria-label="Default pagination" />
    </div>
    <div *ngIf="selectedStoreId != 0 && !loading" class="row justify-content-center mt-2">
        <div class="col-12">
            <h6 class="text-center">Alertas de stock&nbsp;&nbsp;<small><b>Fecha: {{selectedDate}}</b></small></h6>
        </div>
        <div class="card col-{{(isMobile) ? '12 mb-2':'2 ml-2'}}" *ngFor="let itemS of summaryAlerts">
            <div class="mt-3">
                <div [innerHTML]="itemS.type"></div>
            </div>
            <div class="card-body">
                <p>Productos: {{itemS.total}}</p>
                <p>Monto total:</p>
                <p class="text-right"><b>{{itemS.amount | currency: 'CLP'}}</b></p>
            </div>
        </div>
        <div class="col-4  mt-3 card col-{{(isMobile) ? '12 mb-2':'2 ml-2'}}">
            <h6 class="text-center mt-2">Monto total de stock:</h6>
            <p class="text-center"><b>{{sumaTotal | currency: 'CLP'}}</b></p>
        </div>
    </div>
</div>